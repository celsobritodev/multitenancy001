==> Runner: run-e2e-reset.sh (v10.9.8)
==> Drop DB (db_multitenancy)
 pg_terminate_backend 
----------------------
(0 linha)

DROP DATABASE
CREATE DATABASE
==> Start app
==> App started (pid=4882). Logs: .e2e-app.log
==> Wait for STARTED
==> App STARTED.
==> Health check
==> Health OK.
==> Patch ENV (effective env for Newman)
[WARN] controlplane_email nÃ£o encontrado, usando fallback
[WARN] controlplane_password nÃ£o encontrado, usando fallback
tenant_email = e2e_1772142910_9580c5@tenant.local
tenant_password = ***
tenant_tax_id_type = CNPJ
tenant_tax_id_number = 12345678000199
controlplane_email = superadmin@platform.local
controlplane_password = ***
effective_env_written = .env.effective.json
==> ConteÃºdo do arquivo efetivo gerado:
      "key": "controlplane_email",
      "key": "controlplane_password",
==> Run Newman
newman

multitenancy001-e2e (v10.9.3 - FULL - ALL ENDPOINTS - STRICT - tenant ambiguity + diagnostics)

â–¡ ðŸ“¦ 00 - BOOTSTRAP (V3)
â”” 00.01 health
  GET http://localhost:8080/actuator/health [200 OK, 466B, 47ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (GET)
  âˆš  Health OK

â”” 00.02 signup
  POST http://localhost:8080/api/signup [201 Created, 849B, 764ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (POST)
  âˆš  Signup OK
  â”Œ
  â”‚ 'âœ… Conta criada: ID=2, Schema=t_tenant_e2e_f8b394_e8dc
  â”‚ 0da7'
  â””

â”” 00.03 tenant login
  POST http://localhost:8080/api/tenant/auth/login [200 OK, 2.07kB, 338ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (POST)
  âˆš  Tenant login OK
  â”Œ
  â”‚ 'âœ… Tenant logado: ID=1'
  â””

â”” 00.04 tenant me
  GET http://localhost:8080/api/tenant/me [200 OK, 789B, 123ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (GET)
  âˆš  Tenant me OK

â”” 00.05 controlplane login (superadmin)
  POST http://localhost:8080/api/controlplane/auth/login [200 OK, 1.67kB, 273ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (POST)
  âˆš  Login superadmin OK
  â”Œ
  â”‚ 'âœ… Superadmin logado: ID=4'
  â””

â”” 00.06 login as billing manager
  POST http://localhost:8080/api/controlplane/auth/login [200 OK, 1.52kB, 118ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (POST)
  âˆš  Login billing manager OK

â”” 00.07 login as support
  POST http://localhost:8080/api/controlplane/auth/login [200 OK, 1.54kB, 118ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (POST)
  âˆš  Login support OK

â”” 00.08 login as operator
  POST http://localhost:8080/api/controlplane/auth/login [200 OK, 1.45kB, 127ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (POST)
  âˆš  Login operator OK

â–¡ ðŸ” 01 - TENANT AUTH TESTS (V3)
â”” 01.01 tenant refresh
  POST http://localhost:8080/api/tenant/auth/refresh [200 OK, 2.07kB, 84ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (POST)
  âˆš  Tenant refresh OK

â”” 01.02 tenant logout
  POST http://localhost:8080/api/tenant/auth/logout [204 No Content, 423B, 50ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (POST)
  âˆš  Tenant logout OK

â–¡ ðŸ” 01 - TENANT AUTH TESTS (V3) / 01.50 - MULTI-TENANT LOGIN AMBIGUITY (V10.6)
â”” 01.50.01 signup tenant #2
  â”Œ
  â”‚ '[v10.8.5] tenant2_email=e2e2_1772142919413_3ada2f@ten
  â”‚ ant.local'
  â”‚ '[v10.8.5] shared_email=shared_1772142919413_af2e93@te
  â”‚ nant.local'
  â””
  POST http://localhost:8080/api/signup [201 Created, 860B, 346ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (POST)
  âˆš  Tenant #2 signup OK
  â”Œ
  â”‚ 'âœ… Tenant #2 criado: ID=3, Schema=t_tenant_e2e_2_d7704
  â”‚ 0_979fabfb, Slug=tenant-e2e-2-d77040'
  â””

â”” 01.50.02 tenant #2 login (admin)
  POST http://localhost:8080/api/tenant/auth/login [200 OK, 2.1kB, 127ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (POST)
  âˆš  Tenant #2 login OK (direct)

â”” 01.50.03 create shared user in tenant #1
  POST http://localhost:8080/api/tenant/users [201 Created, 800B, 251ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (POST)
  âˆš  Create shared user (201 or 409 if already exists)

â”” 01.50.04 create shared user in tenant #2
  POST http://localhost:8080/api/tenant/users [201 Created, 800B, 192ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (POST)
  âˆš  Create shared user (201 or 409 if already exists)

â”” 01.50.04a controlplane list tenant-users (account #1) - shared index check
  GET http://localhost:8080/api/controlplane/accounts/2/tenant-users [200 OK, 836B, 47ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (GET)
  âˆš  ControlPlane list tenant-users OK
  âˆš  Shared email must be present in tenant-users index

â”” 01.50.04b controlplane list tenant-users (account #2) - shared index check
  GET http://localhost:8080/api/controlplane/accounts/3/tenant-users [200 OK, 843B, 27ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (GET)
  âˆš  ControlPlane list tenant-users OK
  âˆš  Shared email must be present in tenant-users index

â”” 01.50.05 tenant login (ambiguous) => 409 TENANT_SELECTION_REQUIRED
  POST http://localhost:8080/api/tenant/auth/login [401 Unauthorized, 662B, 33ms]
  âˆš  No 5xx in collection
  âˆš  Status code acceptable for SMOKE (POST)
  â”Œ
  â”‚ 'âš ï¸ Ambiguous login returned 401/INVALID_USER. This us
  â”‚ ually means the shared user exists in tenant schemas, 
  â”‚ but the PUBLIC index (login_identities) was not provis
  â”‚ ioned for that email in both accounts.'
  â”‚ '   Expected: public.login_identities should contain 2
  â”‚  rows for shared_email (subject_type=TENANT_ACCOUNT, a
  â”‚ ccount_id=accountId).'
  â”‚ "   Check DB: SELECT subject_type, account_id, subject
  â”‚ _id, email FROM public.login_identities WHERE email = 
  â”‚ '{{shared_email}}';"
  â””
  1. Ambiguous login must return 409
  2. Error must be TENANT_SELECTION_REQUIRED
  3. Must include challengeId
  4. Must include tenants list in details
  âˆš  Must NOT return token yet
  5â „ AssertionFailure in test-script

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         â”‚           executed â”‚             failed â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              iterations â”‚                  1 â”‚                  0 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                requests â”‚                 17 â”‚                  0 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            test-scripts â”‚                 34 â”‚                  1 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      prerequest-scripts â”‚                 21 â”‚                  0 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              assertions â”‚                 57 â”‚                  4 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ total run duration: 4.8s                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ total data received: 11.73kB (approx)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ average response time: 180ms [min: 27ms, max: 764ms, s.d.: 176ms] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[31m  # [39m[31m failure          [39m[31m detail                                                                                                                                                      [39m
[90m    [39m[90m                  [39m[90m                                                                                                                                                             [39m
 1.  AssertionError    Ambiguous login must return 409                                                                                                                             
                       status: expected 401 to deeply equal 409                                                                                                                    
                       at assertion:0 in test-script                                                                                                                               
                       inside "ðŸ” 01 - TENANT AUTH TESTS (V3) / 01.50 - MULTI-TENANT LOGIN AMBIGUITY (V10.6) / 01.50.05 tenant login (ambiguous) => 409 TENANT_SELECTION_REQUIRED" 
[90m    [39m[90m                  [39m[90m                                                                                                                                                             [39m
 2.  AssertionError    Error must be TENANT_SELECTION_REQUIRED                                                                                                                     
                       error/code: expected 'INVALID_USER' to deeply equal 'TENANT_SELECTION_REQUIRED'                                                                             
                       at assertion:1 in test-script                                                                                                                               
                       inside "ðŸ” 01 - TENANT AUTH TESTS (V3) / 01.50 - MULTI-TENANT LOGIN AMBIGUITY (V10.6) / 01.50.05 tenant login (ambiguous) => 409 TENANT_SELECTION_REQUIRED" 
[90m    [39m[90m                  [39m[90m                                                                                                                                                             [39m
 3.  AssertionError    Must include challengeId                                                                                                                                    
                       challengeId: expected undefined to be a string                                                                                                              
                       at assertion:2 in test-script                                                                                                                               
                       inside "ðŸ” 01 - TENANT AUTH TESTS (V3) / 01.50 - MULTI-TENANT LOGIN AMBIGUITY (V10.6) / 01.50.05 tenant login (ambiguous) => 409 TENANT_SELECTION_REQUIRED" 
[90m    [39m[90m                  [39m[90m                                                                                                                                                             [39m
 4.  AssertionError    Must include tenants list in details                                                                                                                        
                       tenants list: expected null to be an array                                                                                                                  
                       at assertion:3 in test-script                                                                                                                               
                       inside "ðŸ” 01 - TENANT AUTH TESTS (V3) / 01.50 - MULTI-TENANT LOGIN AMBIGUITY (V10.6) / 01.50.05 tenant login (ambiguous) => 409 TENANT_SELECTION_REQUIRED" 
[90m    [39m[90m                  [39m[90m                                                                                                                                                             [39m
 5.  AssertionFailure                                                                                                                                                              
                       Ambiguous login must return 409, Error must be TENANT_SELECTION_REQUIRED, Must include challengeId, Must include tenants list in details                    
                       at test-script:39:17                                                                                                                                        
                       inside "ðŸ” 01 - TENANT AUTH TESTS (V3) / 01.50 - MULTI-TENANT LOGIN AMBIGUITY (V10.6) / 01.50.05 tenant login (ambiguous) => 409 TENANT_SELECTION_REQUIRED" 

===========================================================
âŒ Newman FAILED. Showing last 200 lines of app log:
   .e2e-app.log
===========================================================
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:138) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:165) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:88) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:113) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:83) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:72) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:342) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:399) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1774) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:973) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:491) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.50.jar:10.1.50]
	at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]

2026-02-26T18:55:20.662-03:00  WARN 19312 --- [multitenancy001] [nio-8080-exec-5] b.c.m.i.p.audit.SecurityAuditService     : âš ï¸ SecurityAuditService.record chamado com transaÃ§Ã£o jÃ¡ ativa no thread (possÃ­vel nesting TENANT->PUBLIC/JDBC) | actionType=USER_CREATED | outcome=SUCCESS | accountId=3 | tenantSchema=t_tenant_e2e_2_d77040_979fabfb | resources=[com.zaxxer.hikari.HikariDataSource->org.springframework.jdbc.datasource.ConnectionHolder, jdk.proxy4.$Proxy170->org.springframework.orm.jpa.EntityManagerHolder]
2026-02-26T18:55:20.666-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-5] b.c.m.i.s.filter.RequestLoggingFilter    : ðŸŒ [REQ] POST /api/tenant/users | tenant=t_tenant_e2e_2_d77040_979fabfb | status=201 | ip=0:0:0:0:0:0:0:1 | requestId=86fc0912-2dae-4cf4-b2cc-476191891dd1 | thread=50
2026-02-26T18:55:20.666-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-5] b.c.m.shared.context.TenantContext       : ðŸ”„ Tenant bindado para PUBLIC (null) | anterior=t_tenant_e2e_2_d77040_979fabfb | thread=50
2026-02-26T18:55:20.801-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-8] b.c.m.shared.context.TenantContext       : ðŸ”„ Tenant bindado | thread=53 | null -> t_tenant_e2e_f8b394_e8dc0da7
2026-02-26T18:55:20.803-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-8] m.i.p.m.h.TenantSchemaConnectionProvider : ðŸŽ¯ [MT] getConnection | thread=53 | tenantSchemaParam=t_tenant_e2e_f8b394_e8dc0da7 | tenantSchemaThread=t_tenant_e2e_f8b394_e8dc0da7 | SQL=SET search_path TO "t_tenant_e2e_f8b394_e8dc0da7", "public"
Hibernate: 
    select
        tu1_0.id,
        tu1_0.account_id,
        tu1_0.created_at,
        tu1_0.created_by,
        tu1_0.created_by_email,
        tu1_0.deleted_at,
        tu1_0.deleted_by,
        tu1_0.deleted_by_email,
        tu1_0.updated_at,
        tu1_0.updated_by,
        tu1_0.updated_by_email,
        tu1_0.avatar_url,
        tu1_0.deleted,
        tu1_0.email,
        tu1_0.last_login,
        tu1_0.locale,
        tu1_0.locked_until,
        tu1_0.must_change_password,
        tu1_0.name,
        tu1_0.origin,
        tu1_0.password,
        tu1_0.password_changed_at,
        tu1_0.password_reset_expires,
        tu1_0.password_reset_token,
        tu1_0.phone,
        tu1_0.role,
        tu1_0.suspended_by_account,
        tu1_0.suspended_by_admin,
        tu1_0.timezone 
    from
        tenant_users tu1_0 
    where
        tu1_0.account_id=?
Hibernate: 
    select
        p1_0.tenant_user_id,
        p1_0.permission 
    from
        tenant_user_permissions p1_0 
    where
        p1_0.tenant_user_id=?
Hibernate: 
    select
        p1_0.tenant_user_id,
        p1_0.permission 
    from
        tenant_user_permissions p1_0 
    where
        p1_0.tenant_user_id=?
2026-02-26T18:55:20.811-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-8] b.c.m.shared.context.TenantContext       : ðŸ”„ Tenant bindado para PUBLIC (null) | anterior=t_tenant_e2e_f8b394_e8dc0da7 | thread=53
2026-02-26T18:55:20.818-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-8] b.c.m.i.s.filter.RequestLoggingFilter    : ðŸŒ [REQ] GET /api/controlplane/accounts/2/tenant-users | tenant=PUBLIC | status=200 | ip=0:0:0:0:0:0:0:1 | requestId=8c678331-decf-4e8b-b8e3-a64f45f3a9e2 | thread=53
2026-02-26T18:55:20.943-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-6] b.c.m.shared.context.TenantContext       : ðŸ”„ Tenant bindado | thread=51 | null -> t_tenant_e2e_2_d77040_979fabfb
2026-02-26T18:55:20.945-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-6] m.i.p.m.h.TenantSchemaConnectionProvider : ðŸŽ¯ [MT] getConnection | thread=51 | tenantSchemaParam=t_tenant_e2e_2_d77040_979fabfb | tenantSchemaThread=t_tenant_e2e_2_d77040_979fabfb | SQL=SET search_path TO "t_tenant_e2e_2_d77040_979fabfb", "public"
Hibernate: 
    select
        tu1_0.id,
        tu1_0.account_id,
        tu1_0.created_at,
        tu1_0.created_by,
        tu1_0.created_by_email,
        tu1_0.deleted_at,
        tu1_0.deleted_by,
        tu1_0.deleted_by_email,
        tu1_0.updated_at,
        tu1_0.updated_by,
        tu1_0.updated_by_email,
        tu1_0.avatar_url,
        tu1_0.deleted,
        tu1_0.email,
        tu1_0.last_login,
        tu1_0.locale,
        tu1_0.locked_until,
        tu1_0.must_change_password,
        tu1_0.name,
        tu1_0.origin,
        tu1_0.password,
        tu1_0.password_changed_at,
        tu1_0.password_reset_expires,
        tu1_0.password_reset_token,
        tu1_0.phone,
        tu1_0.role,
        tu1_0.suspended_by_account,
        tu1_0.suspended_by_admin,
        tu1_0.timezone 
    from
        tenant_users tu1_0 
    where
        tu1_0.account_id=?
Hibernate: 
    select
        p1_0.tenant_user_id,
        p1_0.permission 
    from
        tenant_user_permissions p1_0 
    where
        p1_0.tenant_user_id=?
Hibernate: 
    select
        p1_0.tenant_user_id,
        p1_0.permission 
    from
        tenant_user_permissions p1_0 
    where
        p1_0.tenant_user_id=?
2026-02-26T18:55:20.951-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-6] b.c.m.shared.context.TenantContext       : ðŸ”„ Tenant bindado para PUBLIC (null) | anterior=t_tenant_e2e_2_d77040_979fabfb | thread=51
2026-02-26T18:55:20.953-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-6] b.c.m.i.s.filter.RequestLoggingFilter    : ðŸŒ [REQ] GET /api/controlplane/accounts/3/tenant-users | tenant=PUBLIC | status=200 | ip=0:0:0:0:0:0:0:1 | requestId=94a10ddf-fcfc-4557-9d2d-9c6cbf1ecf9f | thread=51
2026-02-26T18:55:21.013-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-9] b.c.m.shared.context.TenantContext       : ðŸ”„ Tenant bindado | thread=54 | null -> t_tenant_e2e_f8b394_e8dc0da7
Hibernate: 
    select
        tu1_0.id,
        tu1_0.account_id,
        tu1_0.created_at,
        tu1_0.created_by,
        tu1_0.created_by_email,
        tu1_0.deleted_at,
        tu1_0.deleted_by,
        tu1_0.deleted_by_email,
        tu1_0.updated_at,
        tu1_0.updated_by,
        tu1_0.updated_by_email,
        tu1_0.avatar_url,
        tu1_0.deleted,
        tu1_0.email,
        tu1_0.last_login,
        tu1_0.locale,
        tu1_0.locked_until,
        tu1_0.must_change_password,
        tu1_0.name,
        tu1_0.origin,
        tu1_0.password,
        tu1_0.password_changed_at,
        tu1_0.password_reset_expires,
        tu1_0.password_reset_token,
        tu1_0.phone,
        tu1_0.role,
        tu1_0.suspended_by_account,
        tu1_0.suspended_by_admin,
        tu1_0.timezone 
    from
        tenant_users tu1_0 
    where
        tu1_0.email=? 
        and tu1_0.account_id=? 
        and not(tu1_0.deleted)
2026-02-26T18:55:21.016-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-9] m.i.p.m.h.TenantSchemaConnectionProvider : ðŸŽ¯ [MT] getConnection | thread=54 | tenantSchemaParam=t_tenant_e2e_f8b394_e8dc0da7 | tenantSchemaThread=t_tenant_e2e_f8b394_e8dc0da7 | SQL=SET search_path TO "t_tenant_e2e_f8b394_e8dc0da7", "public"
Hibernate: 
    select
        p1_0.tenant_user_id,
        p1_0.permission 
    from
        tenant_user_permissions p1_0 
    where
        p1_0.tenant_user_id=?
2026-02-26T18:55:21.021-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-9] b.c.m.shared.context.TenantContext       : ðŸ”„ Tenant bindado para PUBLIC (null) | anterior=t_tenant_e2e_f8b394_e8dc0da7 | thread=54
2026-02-26T18:55:21.024-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-9] b.c.m.shared.context.TenantContext       : ðŸ”„ Tenant bindado | thread=54 | null -> t_tenant_e2e_f8b394_e8dc0da7
2026-02-26T18:55:21.024-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-9] b.c.m.shared.context.TenantContext       : ðŸ”„ Tenant bindado para PUBLIC (null) | anterior=t_tenant_e2e_f8b394_e8dc0da7 | thread=54
2026-02-26T18:55:21.024-03:00 DEBUG 19312 --- [multitenancy001] [nio-8080-exec-9] o.s.jdbc.core.JdbcTemplate               : Executing prepared SQL query
2026-02-26T18:55:21.024-03:00 DEBUG 19312 --- [multitenancy001] [nio-8080-exec-9] o.s.jdbc.core.JdbcTemplate               : Executing prepared SQL statement [    select li.account_id,
           a.display_name,
           a.slug
      from public.login_identities li
      join public.accounts a on a.id = li.account_id
     where li.email = ?
       and li.subject_type = 'TENANT_ACCOUNT'
       and a.deleted = false
]
2026-02-26T18:55:21.024-03:00 TRACE 19312 --- [multitenancy001] [nio-8080-exec-9] o.s.jdbc.core.StatementCreatorUtils      : Setting SQL statement parameter value: column index 1, parameter value [shared_1772142919413_af2e93@tenant.local], value class [java.lang.String], SQL type unknown
2026-02-26T18:55:21.026-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-9] b.c.m.shared.context.TenantContext       : ðŸ”„ Tenant bindado | thread=54 | null -> t_tenant_e2e_f8b394_e8dc0da7
2026-02-26T18:55:21.026-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-9] b.c.m.shared.context.TenantContext       : ðŸ”„ Tenant bindado para PUBLIC (null) | anterior=t_tenant_e2e_f8b394_e8dc0da7 | thread=54
2026-02-26T18:55:21.028-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-9] b.c.m.shared.context.TenantContext       : ðŸ”„ Tenant bindado | thread=54 | null -> t_tenant_e2e_f8b394_e8dc0da7
2026-02-26T18:55:21.029-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-9] b.c.m.i.m.o.TenantContextMonitor         : ðŸ” AUTENTICACAO TenantLoginInitService.loginInit(..) (8ms) | tenant(bound=t_tenant_e2e_f8b394_e8dc0da7, effective=t_tenant_e2e_f8b394_e8dc0da7) | motivo: usuario ou senha invalidos
2026-02-26T18:55:21.032-03:00  WARN 19312 --- [multitenancy001] [nio-8080-exec-9] b.c.m.s.a.error.GlobalExceptionHandler   : Authentication failed: usuario ou senha invalidos
2026-02-26T18:55:21.037-03:00  WARN 19312 --- [multitenancy001] [nio-8080-exec-9] .m.m.a.ExceptionHandlerExceptionResolver : Resolved [org.springframework.security.authentication.BadCredentialsException: usuario ou senha invalidos]
2026-02-26T18:55:21.038-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-9] b.c.m.i.s.filter.RequestLoggingFilter    : ðŸŒ [REQ] POST /api/tenant/auth/login | tenant=t_tenant_e2e_f8b394_e8dc0da7 | status=401 | ip=0:0:0:0:0:0:0:1 | requestId=86711948-c53c-406a-bf17-1c3cd1917782 | thread=54
2026-02-26T18:55:21.038-03:00  INFO 19312 --- [multitenancy001] [nio-8080-exec-9] b.c.m.shared.context.TenantContext       : ðŸ”„ Tenant bindado para PUBLIC (null) | anterior=t_tenant_e2e_f8b394_e8dc0da7 | thread=54

==> Diagnostics: attempt to extract shared_email and check public.login_identities
   shared_email detected: shared_1772142919413_af2e93@tenant.local
   Querying public.login_identities for shared_email...
 subject_type | account_id | subject_id | email 
--------------+------------+------------+-------
(0 linha)

===========================================================
==> Stopping app (pid=4882)...
