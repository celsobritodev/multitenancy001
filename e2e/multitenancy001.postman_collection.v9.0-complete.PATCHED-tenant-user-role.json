{
  "info": {
    "_postman_id": "v9-complete-tests-final-61",
    "name": "multitenancy001-e2e (v9.0 - COMPLETE - FINAL - 61)",
    "description": "ColeÃ§Ã£o Ãºnica final com 61 testes: (1) clear no inÃ­cio (collection prerequest), (2) auto-header para rotas /api/tenant/** (collection prerequest), (3) remoÃ§Ã£o de headers repetidos em /api/tenant/**. Inclui BOOTSTRAP + AUTH + CONTROLPLANE + BILLING + CATEGORY + SUBCATEGORY + SUPPLIER + PRODUCT + QUERIES + NEGATIVE + TENANT USERS + CP ACCOUNT QUERIES.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "try { console.clear(); } catch (e) {}",
          "// ==============================================",
          "// ğŸš€ E2E Collection prerequest (single script)",
          "// - Banner 1x (Newman-friendly)",
          "// - Auto-header para rotas /api/tenant/**",
          "// ==============================================",
          "",
          "if (!pm.collectionVariables.get('__e2e_started')) {",
          "  pm.collectionVariables.set('__e2e_started', '1');",
          "  console.log('==============================================');",
          "  console.log('ğŸš€ Starting E2E Collection: multitenancy001');",
          "  console.log('==============================================');",
          "}",
          "",
          "const url = pm.request.url.toString();",
          "",
          "// ===== AUTO-HEADER for /api/tenant/** =====",
          "if (url.includes('/api/tenant/')) {",
          "  const token = pm.environment.get('tenant_access_token');",
          "  const schema = pm.environment.get('tenant_schema');",
          "",
          "  if (token) {",
          "    pm.request.headers.upsert({ key: 'Authorization', value: 'Bearer ' + token });",
          "  }",
          "  if (schema) {",
          "    pm.request.headers.upsert({ key: 'X-Tenant', value: schema });",
          "  }",
          "}"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "ğŸ“¦ 00 - BOOTSTRAP (V3)",
      "description": "Setup inicial - health, signup, logins",
      "item": [
        {
          "name": "00.01 health",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Health OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/actuator/health"
          }
        },
        {
          "name": "00.02 signup",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (!pm.environment.get('tenant_email')) {",
                  "  const ts = Date.now();",
                  "  const email = `e2e_${ts}@tenant.local`;",
                  "  pm.environment.set('tenant_email', email);",
                  "  console.log(`ğŸ“§ Email gerado: ${email}`);",
                  "}"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Signup OK', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('account_id', String(json.account.id));",
                  "pm.environment.set('tenant_schema', json.account.tenantSchema);",
                  "pm.environment.set('tenant_slug', json.account.slug);",
                  "console.log(`âœ… Conta criada: ID=${json.account.id}, Schema=${json.account.tenantSchema}`);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"displayName\": \"Tenant E2E\",\n  \"loginEmail\": \"{{tenant_email}}\",\n  \"taxIdType\": \"{{tenant_tax_id_type}}\",\n  \"taxIdNumber\": \"{{tenant_tax_id_number}}\",\n  \"password\": \"{{tenant_password}}\",\n  \"confirmPassword\": \"{{tenant_password}}\"\n}"
            },
            "url": "{{base_url}}/api/signup"
          }
        },
        {
          "name": "00.03 tenant login",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Tenant login OK', () => pm.expect(pm.response.code).to.eql(200));",
                  "const json = pm.response.json();",
                  "pm.environment.set('tenant_access_token', json.accessToken);",
                  "pm.environment.set('tenant_refresh_token', json.refreshToken);",
                  "pm.environment.set('tenant_user_id', String(json.userId));",
                  "console.log(`âœ… Tenant logado: ID=${json.userId}`);"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{tenant_email}}\",\n  \"password\": \"{{tenant_password}}\"\n}"
            },
            "url": "{{base_url}}/api/tenant/auth/login"
          }
        },
        {
          "name": "00.04 tenant me",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Tenant me OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/tenant/me"
          }
        },
        {
          "name": "00.05 controlplane login (superadmin)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Login superadmin OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('superadmin_token', json.accessToken);",
                  "pm.environment.set('superadmin_refresh', json.refreshToken);",
                  "pm.environment.set('superadmin_user_id', String(json.userId));",
                  "console.log(`âœ… Superadmin logado: ID=${json.userId}`);"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"superadmin@platform.local\",\n  \"password\": \"admin123\"\n}"
            },
            "url": "{{base_url}}/api/controlplane/auth/login"
          }
        },
        {
          "name": "00.06 login as billing manager",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Login billing manager OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('billing_token', json.accessToken);",
                  "pm.environment.set('billing_refresh', json.refreshToken);"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"billing@platform.local\",\n  \"password\": \"admin123\"\n}"
            },
            "url": "{{base_url}}/api/controlplane/auth/login"
          }
        },
        {
          "name": "00.07 login as support",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Login support OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('support_token', json.accessToken);",
                  "pm.environment.set('support_refresh', json.refreshToken);"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"support@platform.local\",\n  \"password\": \"admin123\"\n}"
            },
            "url": "{{base_url}}/api/controlplane/auth/login"
          }
        },
        {
          "name": "00.08 login as operator",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Login operator OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('operator_token', json.accessToken);",
                  "pm.environment.set('operator_refresh', json.refreshToken);"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"operator@platform.local\",\n  \"password\": \"admin123\"\n}"
            },
            "url": "{{base_url}}/api/controlplane/auth/login"
          }
        }
      ]
    },
    {
      "name": "ğŸ” 01 - TENANT AUTH TESTS (V3)",
      "description": "Testes de refresh e logout do tenant",
      "item": [
        {
          "name": "01.01 tenant refresh",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Tenant refresh OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('tenant_refresh_old', pm.environment.get('tenant_refresh_token'));",
                  "pm.environment.set('tenant_access_token', json.accessToken);",
                  "pm.environment.set('tenant_refresh_token', json.refreshToken);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{tenant_refresh_token}}\"\n}"
            },
            "url": "{{base_url}}/api/tenant/auth/refresh"
          }
        },
        {
          "name": "01.02 tenant logout",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Tenant logout OK', () => pm.expect(pm.response.code).to.be.oneOf([204]));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{tenant_refresh_token}}\",\n  \"allDevices\": false\n}"
            },
            "url": "{{base_url}}/api/tenant/auth/logout"
          }
        }
      ]
    },
    {
      "name": "ğŸ¯ 02 - CONTROL PLANE AUTH TESTS (V3)",
      "description": "Testes de refresh e logout do control plane",
      "item": [
        {
          "name": "02.01 controlplane refresh",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Controlplane refresh OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('superadmin_token_new', json.accessToken);",
                  "pm.environment.set('superadmin_refresh_new', json.refreshToken);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{superadmin_refresh}}\"\n}"
            },
            "url": "{{base_url}}/api/controlplane/auth/refresh"
          }
        },
        {
          "name": "02.02 controlplane logout",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Controlplane logout OK', () => pm.expect(pm.response.code).to.be.oneOf([204]));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{superadmin_refresh_new}}\"\n}"
            },
            "url": "{{base_url}}/api/controlplane/auth/logout"
          }
        }
      ]
    },
    {
      "name": "ğŸ’° 03 - BILLING MANAGER TESTS (V4)",
      "description": "Testes especÃ­ficos do billing manager",
      "item": [
        {
          "name": "03.01 billing manager me",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Billing manager me OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.expect(json.email).to.equal('billing@platform.local');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{billing_token}}"
              }
            ],
            "url": "{{base_url}}/api/controlplane/me"
          }
        },
        {
          "name": "03.02 billing manager refresh",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Refresh OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('billing_token_new', json.accessToken);",
                  "pm.environment.set('billing_refresh_new', json.refreshToken);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{billing_refresh}}\"\n}"
            },
            "url": "{{base_url}}/api/controlplane/auth/refresh"
          }
        },
        {
          "name": "03.03 billing manager logout",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Logout OK', () => pm.expect(pm.response.code).to.be.oneOf([204]));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{billing_refresh_new}}\"\n}"
            },
            "url": "{{base_url}}/api/controlplane/auth/logout"
          }
        }
      ]
    },
    {
      "name": "ğŸ†˜ 04 - SUPPORT TESTS (V5)",
      "description": "Testes de permissÃµes do support",
      "item": [
        {
          "name": "04.01 support me",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Support me OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.expect(json.email).to.equal('support@platform.local');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{support_token}}"
              }
            ],
            "url": "{{base_url}}/api/controlplane/me"
          }
        },
        {
          "name": "04.02 support list accounts",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Support list accounts OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{support_token}}"
              }
            ],
            "url": "{{base_url}}/api/controlplane/accounts"
          }
        },
        {
          "name": "04.03 support list users",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Support list users OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{support_token}}"
              }
            ],
            "url": "{{base_url}}/api/controlplane/users"
          }
        }
      ]
    },
    {
      "name": "âš™ï¸ 05 - OPERATOR TESTS (V5)",
      "description": "Testes de permissÃµes do operator",
      "item": [
        {
          "name": "05.01 operator me",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Operator me OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.expect(json.email).to.equal('operator@platform.local');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{operator_token}}"
              }
            ],
            "url": "{{base_url}}/api/controlplane/me"
          }
        },
        {
          "name": "05.02 operator list accounts",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Operator list accounts OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{operator_token}}"
              }
            ],
            "url": "{{base_url}}/api/controlplane/accounts"
          }
        },
        {
          "name": "05.03 operator cannot list users",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Operator cannot list users (403)', () => pm.expect(pm.response.code).to.be.oneOf([403]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{operator_token}}"
              }
            ],
            "url": "{{base_url}}/api/controlplane/users"
          }
        }
      ]
    },
    {
      "name": "ğŸ’³ 06 - BILLING TESTS (V6)",
      "description": "Testes de criaÃ§Ã£o e consulta de pagamentos",
      "item": [
        {
          "name": "06.01 superadmin create payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Superadmin create payment OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{superadmin_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"accountId\": \"{{account_id}}\",\n  \"amount\": 100.00,\n  \"paymentMethod\": \"CREDIT_CARD\",\n  \"paymentGateway\": \"STRIPE\",\n  \"description\": \"Test payment\"\n}"
            },
            "url": "{{base_url}}/api/controlplane/billing/payments"
          }
        },
        {
          "name": "06.02 superadmin list pending payments",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Superadmin list pending payments OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{superadmin_token}}"
              }
            ],
            "url": "{{base_url}}/api/admin/billing/payments/query/status/PENDING"
          }
        },
        {
          "name": "06.03 superadmin get total paid",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Superadmin get total paid OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{superadmin_token}}"
              }
            ],
            "url": "{{base_url}}/api/admin/billing/payments/query/accounts/{{account_id}}/total-paid?startDate=2024-01-01T00:00:00Z&endDate=2024-12-31T23:59:59Z"
          }
        },
        {
          "name": "06.04 superadmin count completed payments",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Superadmin count completed OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{superadmin_token}}"
              }
            ],
            "url": "{{base_url}}/api/admin/billing/payments/query/accounts/{{account_id}}/count-completed"
          }
        },
        {
          "name": "06.05 billing manager list pending payments",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Billing manager list pending payments OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{billing_token}}"
              }
            ],
            "url": "{{base_url}}/api/admin/billing/payments/query/status/PENDING"
          }
        },
        {
          "name": "06.06 support cannot list payments",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Support cannot list payments (403)', () => pm.expect(pm.response.code).to.be.oneOf([403]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{support_token}}"
              }
            ],
            "url": "{{base_url}}/api/admin/billing/payments/query/status/PENDING"
          }
        },
        {
          "name": "06.07 operator cannot list payments",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Operator cannot list payments (403)', () => pm.expect(pm.response.code).to.be.oneOf([403]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{operator_token}}"
              }
            ],
            "url": "{{base_url}}/api/admin/billing/payments/query/status/PENDING"
          }
        }
      ]
    },
    {
      "name": "ğŸ—‚ï¸ 07 - CATEGORY TESTS (V7)",
      "description": "CRUD de categorias",
      "item": [
        {
          "name": "07.01 create category",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Create category OK', () => pm.expect(pm.response.code).to.be.oneOf([201]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('category_id', String(json.id));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"EletrÃ´nicos\"\n}"
            },
            "url": "{{base_url}}/api/tenant/categories"
          }
        },
        {
          "name": "07.02 create another category",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Create category OK', () => pm.expect(pm.response.code).to.be.oneOf([201]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('category_id_2', String(json.id));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Livros\"\n}"
            },
            "url": "{{base_url}}/api/tenant/categories"
          }
        },
        {
          "name": "07.03 list all categories",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('List categories OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.expect(json.length).to.be.at.least(2);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/tenant/categories"
          }
        },
        {
          "name": "07.04 get category by id",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Get category OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.expect(json.id).to.equal(Number(pm.environment.get('category_id')));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/tenant/categories/{{category_id}}"
          }
        },
        {
          "name": "07.05 update category",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Update category OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"EletrÃ´nicos Atualizado\"\n}"
            },
            "url": "{{base_url}}/api/tenant/categories/{{category_id}}"
          }
        },
        {
          "name": "07.06 toggle category active",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Toggle active OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "url": "{{base_url}}/api/tenant/categories/{{category_id}}/toggle-active"
          }
        },
        {
          "name": "07.07 soft delete category",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Soft delete OK', () => pm.expect(pm.response.code).to.be.oneOf([204]));"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "url": "{{base_url}}/api/tenant/categories/{{category_id}}"
          }
        },
        {
          "name": "07.08 restore category",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Restore OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "url": "{{base_url}}/api/tenant/categories/{{category_id}}/restore"
          }
        }
      ]
    },
    {
      "name": "ğŸ“‚ 08 - SUBCATEGORY TESTS (V7)",
      "description": "Testes de subcategorias",
      "item": [
        {
          "name": "08.01 create subcategory",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Create subcategory OK', () => pm.expect(pm.response.code).to.be.oneOf([201]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('subcategory_id', String(json.id));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Smartphones\"\n}"
            },
            "url": "{{base_url}}/api/tenant/subcategories/category/{{category_id_2}}"
          }
        },
        {
          "name": "08.02 list subcategories by category",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('List subcategories OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.expect(json.length).to.be.at.least(1);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/tenant/subcategories/category/{{category_id_2}}/not-deleted"
          }
        }
      ]
    },
    {
      "name": "ğŸ­ 09 - SUPPLIER TESTS (V7)",
      "description": "Testes de fornecedores",
      "item": [
        {
          "name": "09.01 create supplier",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Create supplier OK', () => pm.expect(pm.response.code).to.be.oneOf([201]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('supplier_id', json.id);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Fornecedor Teste\",\n  \"email\": \"fornecedor@teste.com\",\n  \"phone\": \"11999999999\",\n  \"document\": \"12345678000199\",\n  \"documentType\": \"CNPJ\"\n}"
            },
            "url": "{{base_url}}/api/tenant/suppliers"
          }
        },
        {
          "name": "09.02 list suppliers",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('List suppliers OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.expect(json.length).to.be.at.least(1);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/tenant/suppliers"
          }
        }
      ]
    },
    {
      "name": "ğŸ“¦ 10 - PRODUCT TESTS (V7)",
      "description": "CRUD de produtos",
      "item": [
        {
          "name": "10.01 create product",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Create product OK', () => pm.expect(pm.response.code).to.be.oneOf([201]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('product_id', json.id);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Smartphone XYZ\",\n  \"sku\": \"SM-001\",\n  \"price\": 1999.99,\n  \"categoryId\": {{category_id_2}},\n  \"subcategoryId\": {{subcategory_id}},\n  \"stockQuantity\": 10,\n  \"brand\": \"Apple\"\n}"
            },
            "url": "{{base_url}}/api/tenant/products/detailed"
          }
        },
        {
          "name": "10.02 list products",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('List products OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.expect(json.content.length).to.be.at.least(1);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/tenant/products?page=0&size=10"
          }
        },
        {
          "name": "10.03 get product by id",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Get product OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));",
                  "const json = pm.response.json();",
                  "pm.expect(json.name).to.equal('Smartphone XYZ');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/tenant/products/{{product_id}}"
          }
        },
        {
          "name": "10.04 update product cost",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Update cost OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "url": "{{base_url}}/api/tenant/products/{{product_id}}/cost-price?costPrice=1500.00"
          }
        },
        {
          "name": "10.05 toggle product active",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Toggle active OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "url": "{{base_url}}/api/tenant/products/{{product_id}}/toggle-active"
          }
        }
      ]
    },
    {
      "name": "ğŸ” 11 - PRODUCT QUERIES (V7)",
      "description": "Consultas de produtos",
      "item": [
        {
          "name": "11.01 list products by category",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('List by category OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/tenant/products/category/{{category_id_2}}"
          }
        },
        {
          "name": "11.02 count low stock",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Count low stock OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/tenant/products/low-stock/count?threshold=5"
          }
        },
        {
          "name": "11.03 search products",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Search products OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/tenant/products/search?name=Smartphone"
          }
        }
      ]
    },
    {
      "name": "âš ï¸ 12 - NEGATIVE TESTS (V7)",
      "description": "Testes de validaÃ§Ã£o",
      "item": [
        {
          "name": "12.01 create product without category",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Create without category fails (400)', () => pm.expect(pm.response.code).to.be.oneOf([400]));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Produto Sem Categoria\",\n  \"sku\": \"SEM-001\",\n  \"price\": 99.99\n}"
            },
            "url": "{{base_url}}/api/tenant/products/detailed"
          }
        },
        {
          "name": "12.02 create duplicate sku",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Duplicate SKU fails (409)', () => pm.expect(pm.response.code).to.be.oneOf([409]));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Outro Smartphone\",\n  \"sku\": \"SM-001\",\n  \"price\": 1999.99,\n  \"categoryId\": {{category_id_2}}\n}"
            },
            "url": "{{base_url}}/api/tenant/products/detailed"
          }
        }
      ]
    },
    {
      "name": "ğŸ‘¥ 13 - TENANT USERS TESTS (ADDED to reach 61)",
      "description": "Endpoints existentes em TenantUserController (CRUD + status + soft delete/restore).",
      "item": [
        {
          "name": "13.01 create tenant user",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const ts = Date.now();",
                  "pm.environment.set('tenant_user_email', `e2e_user_${ts}@tenant.local`);"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Create tenant user OK', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));",
                  "const json = pm.response.json();",
                  "pm.environment.set('tenant_user_created_id', String(json.id));"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"E2E User\",\n  \"email\": \"{{tenant_user_email}}\",\n  \"role\": \"TENANT_USER\",\n  \"permissions\": []\n}"
            },
            "url": "{{base_url}}/api/tenant/users"
          }
        },
        {
          "name": "13.02 list tenant users",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('List tenant users OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/tenant/users"
          }
        },
        {
          "name": "13.03 get tenant user by id",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Get tenant user OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/tenant/users/{{tenant_user_created_id}}"
          }
        },
        {
          "name": "13.04 count enabled tenant users",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Count enabled OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{base_url}}/api/tenant/users/count-enabled"
          }
        },
        {
          "name": "13.05 suspend by admin (status)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Suspend status OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "url": "{{base_url}}/api/tenant/users/{{tenant_user_created_id}}/status?suspendedByAdmin=true"
          }
        },
        {
          "name": "13.06 unsuspend by admin (status)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Unsuspend status OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "url": "{{base_url}}/api/tenant/users/{{tenant_user_created_id}}/status?suspendedByAdmin=false"
          }
        },
        {
          "name": "13.07 soft delete tenant user",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Soft delete OK', () => pm.expect(pm.response.code).to.be.oneOf([200,204]));"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "url": "{{base_url}}/api/tenant/users/{{tenant_user_created_id}}/soft-delete"
          }
        },
        {
          "name": "13.08 restore tenant user",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Restore OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "url": "{{base_url}}/api/tenant/users/{{tenant_user_created_id}}/restore"
          }
        }
      ]
    },
    {
      "name": "ğŸ¢ 14 - CONTROLPLANE ACCOUNT QUERIES (ADDED to reach 61)",
      "description": "Consultas de conta no controlplane (GET-only) usando superadmin.",
      "item": [
        {
          "name": "14.01 superadmin get account by id",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Get account OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{superadmin_token}}"
              }
            ],
            "url": "{{base_url}}/api/controlplane/accounts/{{account_id}}"
          }
        },
        {
          "name": "14.02 superadmin get account admin details",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Admin details OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{superadmin_token}}"
              }
            ],
            "url": "{{base_url}}/api/controlplane/accounts/{{account_id}}/admin-details"
          }
        },
        {
          "name": "14.03 superadmin list account tenant users",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Tenant users list OK', () => pm.expect(pm.response.code).to.be.oneOf([200]));"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{superadmin_token}}"
              }
            ],
            "url": "{{base_url}}/api/controlplane/accounts/{{account_id}}/tenant-users"
          }
        }
      ]
    }
  ]
}